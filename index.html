<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–∫—Ç–∏–≤—ã –û–Ω–ª–∞–π–Ω</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/300/line-chart.png">

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --bg: #000000; --card: #1c1c1e; --accent: #30d158; --text: #ffffff; --sec: #8e8e93; }
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); overscroll-behavior: none; }
        
        .refresh-btn { position: fixed; top: 45px; right: 20px; width: 35px; height: 35px; background: #2c2c2e; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1000; border: none; color: white; opacity: 0.6; }
        
        .screen { display: none; padding: 20px; min-height: 100vh; flex-direction: column; }
        .screen.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Auth */
        .auth-form { margin-top: 100px; text-align: center; padding: 0 10px; }
        input { width: 100%; padding: 18px; border-radius: 14px; background: #1c1c1e; border: 1px solid #333; color: white; font-size: 16px; margin-bottom: 12px; outline: none; }
        .btn { width: 100%; padding: 18px; border-radius: 14px; border: none; font-size: 16px; font-weight: 600; background: var(--accent); color: white; margin-top: 10px; }

        /* Portfolio */
        .header { margin-top: 40px; }
        .total-label { color: var(--sec); font-size: 14px; }
        .total-amount { font-size: 38px; font-weight: 800; margin: 5px 0; letter-spacing: -1px; }
        .profit { color: var(--accent); font-size: 14px; font-weight: 500; }

        /* Chart */
        .chart-container { height: 100px; width: 100%; margin: 25px 0; display: flex; align-items: flex-end; gap: 3px; }
        .chart-bar { flex: 1; background: linear-gradient(to top, rgba(48, 209, 88, 0.1), rgba(48, 209, 88, 0.7)); border-radius: 2px; }

        .section-title { font-size: 20px; font-weight: 700; margin: 25px 0 15px; }
        .asset-item { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 0.5px solid #2c2c2e; }
        .asset-icon { width: 42px; height: 42px; border-radius: 12px; background: #2c2c2e; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 14px; }
        .asset-name { font-weight: 600; font-size: 16px; }
        .asset-ticker { font-size: 12px; color: var(--sec); }
        .asset-price { text-align: right; font-weight: 600; }
        .asset-ch { font-size: 12px; color: var(--accent); }

        footer { text-align: center; font-size: 10px; color: #444; padding: 40px 20px; line-height: 1.5; }
    </style>
</head>
<body>

    <button class="refresh-btn" onclick="location.reload()">üîÑ</button>

    <div id="screen-auth" class="screen active">
        <div class="auth-form">
            <div style="font-size:60px; margin-bottom:20px">üìä</div>
            <h1 style="font-size:32px; margin-bottom:10px">–ê–∫—Ç–∏–≤—ã –û–Ω–ª–∞–π–Ω</h1>
            <p style="color:var(--sec); margin-bottom:40px">–í—Ö–æ–¥ –≤ —Ç–æ—Ä–≥–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª</p>
            <input type="text" id="log" placeholder="–õ–æ–≥–∏–Ω">
            <input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn" id="loginBtn" onclick="login()">–í–æ–π—Ç–∏ –∏–ª–∏ –°–æ–∑–¥–∞—Ç—å</button>
            <p id="err" style="color:#ff453a; font-size:14px; margin-top:15px; display:none">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
        </div>
        <footer>–°–æ–∑–¥–∞–Ω–æ –≤ —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö.</footer>
    </div>

    <div id="screen-main" class="screen">
        <div class="header">
            <div class="total-label" id="uLabel">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="total-amount" id="uTotal">0 ‚ÇΩ</div>
            <div class="profit" id="uProfit">‚ñ≤ +0 ‚ÇΩ (0%) —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="chart-container" id="chart"></div>
        <div class="section-title">–ê–∫—Ç–∏–≤—ã</div>
        <div id="assets-list"></div>
        <div class="section-title">–î–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</div>
        <div id="currency-list"></div>
        <footer>–î–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º.</footer>
    </div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE (–¢–≤–æ—è –±–∞–∑–∞)
        const firebaseConfig = {
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg",
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webapp-b7149",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        async function login() {
            const loginBtn = document.getElementById('loginBtn');
            const log = document.getElementById('log').value.trim();
            const pw = document.getElementById('pass').value.trim();
            const err = document.getElementById('err');

            if(!log || !pw) return;
            loginBtn.innerText = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...";

            const snapshot = await db.ref('users/' + log).once('value');
            const userData = snapshot.val();

            if (userData) {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
                if (userData.pw === pw) {
                    render(userData, log);
                    showMain();
                } else {
                    err.style.display = 'block';
                    loginBtn.innerText = "–í–æ–π—Ç–∏ –∏–ª–∏ –°–æ–∑–¥–∞—Ç—å";
                }
            } else {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º (—Å–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–ø–æ—Ä—Ç—Ñ–µ–ª—å)
                const newUser = {
                    pw: pw,
                    total: 5000,
                    bonus: 0,
                    stocks: [
                        {n: "–°–±–µ—Ä", t: "SBER", p: 2500, i: "üçè"},
                        {n: "–ì–∞–∑–ø—Ä–æ–º", t: "GAZP", p: 2500, i: "üî•"}
                    ]
                };
                await db.ref('users/' + log).set(newUser);
                render(newUser, log);
                showMain();
            }
        }

        function showMain() {
            document.getElementById('screen-auth').classList.remove('active');
            document.getElementById('screen-main').classList.add('active');
        }

        function render(u, name) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ü–∏–π, –µ—Å–ª–∏ –ø–æ–ª–µ total –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤—Ä—É—á–Ω—É—é
            let calculatedTotal = 0;
            const al = document.getElementById('assets-list');
            al.innerHTML = '';

            if (u.stocks) {
                u.stocks.forEach(s => {
                    calculatedTotal += s.p;
                    al.innerHTML += `
                        <div class="asset-item">
                            <div style="display:flex; align-items:center">
                                <div class="asset-icon">${s.i || 'üìà'}</div>
                                <div>
                                    <div class="asset-name">${s.n}</div>
                                    <div class="asset-ticker">${s.t}</div>
                                </div>
                            </div>
                            <div class="asset-price">
                                <div>${s.p.toLocaleString()} ‚ÇΩ</div>
                                <div class="asset-ch">+${(Math.random()*2).toFixed(1)}%</div>
                            </div>
                        </div>
                    `;
                });
            }

            // –ï—Å–ª–∏ –≤ –±–∞–∑–µ –µ—Å—Ç—å –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π total, –±–µ—Ä–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ —Å—É–º–º—É –∞–∫—Ü–∏–π
            const finalTotal = u.total || calculatedTotal;

            document.getElementById('uLabel').innerText = `–ü–æ—Ä—Ç—Ñ–µ–ª—å ${name}`;
            document.getElementById('uTotal').innerText = finalTotal.toLocaleString() + " ‚ÇΩ";
            
            const dayProfit = Math.floor(finalTotal * 0.008);
            document.getElementById('uProfit').innerText = `‚ñ≤ +${dayProfit.toLocaleString()} ‚ÇΩ (0.8%) —Å–µ–≥–æ–¥–Ω—è`;

            // –ì—Ä–∞—Ñ–∏–∫
            const chart = document.getElementById('chart');
            chart.innerHTML = '';
            for(let i=0; i<25; i++) {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = (40 + Math.random() * 60) + '%';
                chart.appendChild(bar);
            }

            // –í–∞–ª—é—Ç–∞
            document.getElementById('currency-list').innerHTML = `
                <div class="asset-item">
                    <div style="display:flex; align-items:center">
                        <div class="asset-icon">üá∑üá∫</div>
                        <div><div class="asset-name">–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å</div><div class="asset-ticker">RUB</div></div>
                    </div>
                    <div class="asset-price">${finalTotal.toLocaleString()} ‚ÇΩ</div>
                </div>
                <div class="asset-item">
                    <div style="display:flex; align-items:center">
                        <div class="asset-icon">üéÅ</div>
                        <div><div class="asset-name">–ö—ç—à–±—ç–∫</div><div class="asset-ticker">BONUS</div></div>
                    </div>
                    <div class="asset-price">${u.bonus || 0} –±–∞–ª–ª–æ–≤</div>
                </div>
            `;
        }
    </script>
</body>
</html>
